<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pokedex — Explore Pokémon</title>

  <!-- Stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">

  <!-- Favicon (optional) -->
  <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/png">
</head>
<body>
  <div class="container">
    <header class="header" role="banner">
      <a class="brand" href="{{ url_for('index') }}">
        <div class="logo">PK</div>
        <div>
          <h1>Pokedex</h1>
          <p>Explore Pokémon — quick, clean, and searchable</p>
        </div>
      </a>

      <nav class="nav" role="navigation" aria-label="Primary">
        <a class="btn btn--ghost" href="#">About</a>
        <a class="btn btn--primary" href="#pokedex">Browse</a>
      </nav>
    </header>

    <main>
      <section class="hero" aria-labelledby="hero-title">
        <div class="left">
          <h2 id="hero-title">Find Pokémon by name, id, or type</h2>
          <p>Use the search and filters below to explore the pokedex.json dataset.</p>

          <form id="searchForm" method="get" action="{{ url_for('index') }}" class="controls" role="search">
            <input
              class="input"
              id="searchInput"
              name="q"
              type="search"
              placeholder="Search by name or id..."
              value="{{ query|default('') }}"
              aria-label="Search pokedex">

            <select name="gen" id="genSelect" class="input" aria-label="Filter by generation">
              <option value="">All generations</option>
              {% for g in gens %}
                <option value="{{ g }}" {% if selected_gen|default('') == g %}selected{% endif %}>Generation {{ g }}</option>
              {% endfor %}
            </select>

            <button class="btn btn--primary" type="submit">Search</button>
            <button type="button" class="btn btn--ghost" id="clearBtn">Clear</button>
          </form>
        </div>

        <div class="right" aria-hidden="true">
          <div style="width:120px;height:120px;border-radius:12px;background:linear-gradient(135deg,var(--primary), #8E7BFF);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:28px">PK</div>
        </div>
      </section>

      <!-- Quick stats -->
      <div class="row" style="margin-top:12px;align-items:center;justify-content:space-between;">
        <div class="col">
          <div class="kv">Showing
            <strong id="resultCount">{{ pokedex|length if pokedex is defined else 0 }}</strong>
            Pokémon
          </div>
          <div class="kv" style="margin-top:6px;color:var(--muted)">Tip: try searching "fire" or "25"</div>
        </div>
      </div>

      <!-- Grid cards (first 6) -->
      <div class="grid" aria-live="polite" style="margin-top:18px">
        {% for p in pokedex[:6] %}
        <article class="card" data-name="{{ p.get('name','')|lower }}" data-types="{{ p.get('type','')|join(' ')|lower }}">
          <div style="display:flex;gap:12px;align-items:center">
            <div style="width:56px;height:56px;border-radius:10px;background:#f3f4fb;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--primary)">
              {{ p.get('id') }}
            </div>
            <div>
              <div class="title">{{ p.get('name') }}</div>
              <div class="meta">Type: {{ p.get('type')|join(' / ') }}</div>
            </div>
          </div>
        </article>
        {% else %}
        <div class="card">No Pokémon found to preview.</div>
        {% endfor %}
      </div>

      <!-- Full table -->
      <section id="pokedex" style="margin-top:28px">
        <div class="card">
          <h3 style="margin-top:0">Pokedex</h3>

          <table class="table" id="pokedexTable" role="table" aria-label="Pokedex table">
            <thead>
              <tr>
                <th style="width:90px">#</th>
                <th>Name</th>
                <th>Type</th>
                <th>Generation</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              {% for p in pokedex %}
              <tr class="poke-row" data-name="{{ p.get('name','')|lower }}" data-types="{{ p.get('type','')|join(' ')|lower }}">
                <td><strong>{{ p.get('id') }}</strong></td>
                <td>{{ p.get('name') }}</td>
                <td>
                  {% for t in p.get('type', []) %}
                    <span class="badge">{{ t }}</span>
                  {% endfor %}
                </td>
                <td>{{ p.get('generation') }}</td>
                <td class="kv">{{ p.get('notes', '') }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <footer class="footer">
        <div>Made with ❤️ • Pokedex demo</div>
      </footer>
    </main>
  </div>

  <!-- Client-side filtering for instant UX -->
  <script>
    (function(){
      const searchInput = document.getElementById('searchInput');
      const clearBtn = document.getElementById('clearBtn');
      const rows = Array.from(document.querySelectorAll('.poke-row'));
      const resultCount = document.getElementById('resultCount');

      function normalize(s){ return (s||'').toString().toLowerCase(); }

      function filterRows(term) {
        const q = normalize(term);
        let visible = 0;
        rows.forEach(r=>{
          const name = r.dataset.name || '';
          const types = r.dataset.types || '';
          const id = (r.querySelector('td strong')||{}).textContent || '';
          const hay = [name, types, id].join(' ');
          if (!q || hay.indexOf(q) !== -1) {
            r.style.display = '';
            visible++;
          } else {
            r.style.display = 'none';
          }
        });
        if (resultCount) resultCount.textContent = visible;
      }

      searchInput && searchInput.addEventListener('input', (e)=> filterRows(e.target.value));
      clearBtn && clearBtn.addEventListener('click', ()=>{
        if (searchInput) searchInput.value = '';
        filterRows('');
        try {
          const url = new URL(window.location);
          url.searchParams.delete('q');
          window.history.replaceState({}, '', url);
        } catch(e){}
      });

      document.addEventListener('DOMContentLoaded', ()=>{
        filterRows(searchInput ? searchInput.value : '');
      });
    })();
  </script>
</body>
</html>
